<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>使用状态模式和状态机进行红绿灯演示</title>
  </head>
  <body>
    <div id="lightText"></div>
    <script>
const el = document.getElementById('lightText')
// 初始化红绿灯状态  
let state = 'red';
let count = null
let timer = null

  
// 定义红绿灯状态切换的函数  
function trafficLight() {  
    if (state === 'red') {  
        if (count) {
            count--
        } else {
            // 假设绿灯持续 5 秒 
            count = 5
        }
        el.textContent = `红灯倒计时：${count}`
        if (!timer) {
            timer = setTimeout(function() { 
                state = 'green'
                timer = null
                count = null
            }, 5000)
        }
    } else if (state === 'green') {  
        if (count) {
            count--
        } else {
            // 假设绿灯持续 3 秒 
            count = 3
        }
        el.textContent = `绿灯倒计时：${count}`
        if (!timer) {
            isTimerCleared = true
            timer = setTimeout(function() {
                state = 'yellow'  
                timer = null
                count = null
            }, 3000)
        }
    } else if (state === 'yellow') {  
        if (count) {
            count--
        } else {
            // 假设黄灯持续 2 秒 
            count = 2
        }
        el.textContent = `黄灯倒计时：${count}`
        if (!timer) {
            timer = setTimeout(function() {
                state = 'red'  
                timer = null
                count = null 
            }, 2000)
        }
    }  
}  
  
// 启动红绿灯状态切换  
trafficLight()
// 每秒执行一次，以实现倒计时
setInterval(trafficLight, 1000)
 
    </script>
  <body>
</html>